# 获取3级域名解析列表接口

## 接口描述

该接口用于获取指定子域名和域名的3级域名解析记录列表。系统会根据请求中的子域名和域名，结合当前用户的邮箱信息，查询符合条件的域名解析记录。用户只能查询自己创建的域名解析记录。

## 请求URL

```
POST /api/user/domains/subdomains/list
```

## 请求方式

POST

## 请求头

| 参数名 | 必选 | 类型 | 说明 |
|:----:|:---:|:----:|:----:|
| Authorization | 是 | string | Bearer {token} 格式的JWT令牌 |

## 请求参数

| 参数名 | 必选 | 类型 | 说明 |
|:----:|:---:|:----:|:----:|
| subdomain | 是 | string | 子域名前缀 |
| domain | 否 | string | 主域名，默认为"cblog.eu" |
| remark | 否 | string | 备注信息，不需要填写，系统会自动从token中获取用户邮箱 |

## 请求示例

```json
{
    "subdomain": "ff",
    "domain": "cblog.eu"
}
```

## 响应参数

| 参数名 | 类型 | 说明 |
|:----:|:----:|:----:|
| code | int | 状态码，200表示成功，其他表示失败 |
| message | string | 响应消息 |
| data | array | 域名解析记录列表 |

## 响应示例

### 成功响应

```json
{
    "code": 200,
    "message": "查询成功",
    "data": [
        {
            "id": 30,
            "userId": 1,
            "subdomain": "aa.ff",
            "domain": "cblog.eu",
            "recordId": 2171768395,
            "ipAddress": "8.8.8.8",
            "ttl": 600,
            "status": "ACTIVE",
            "remark": "ff.12345678@example.com",
            "createTime": "2025-08-23T18:53:13",
            "updateTime": "2025-08-23T18:53:13"
        }
    ]
}
```

#### 成功响应（无记录）

```json
{
    "code": 200,
    "message": "查询成功",
    "data": []
}
```

### 失败响应

#### 未授权错误（401）
```json
{
    "code": 401,
    "message": "未授权：需要有效的JWT令牌",
    "data": null,
    "timestamp": "2025-08-23T22:26:33.719922782"
}
```

#### 参数错误（400）
```json
{
    "code": 400,
    "message": "子域名前缀不能为空",
    "data": null,
    "timestamp": "2025-08-23T22:26:33.617427502"
}
```

#### 服务器错误（500）
```json
{
    "code": 500,
    "message": "获取3级域名解析列表失败: JWT strings must contain exactly 2 period characters. Found: 0",
    "data": null,
    "timestamp": "2025-08-23T22:26:33.712465448"
}
```

#### 其他可能的错误
- 404：请求的资源不存在
- 403：权限不足，无法访问该资源
- 429：请求过于频繁，请稍后再试

## 业务流程

1. 从JWT token中获取用户邮箱
2. 验证请求参数
3. 构造remark格式(subdomain.email)
4. 根据domain和remark查询记录
5. 返回查询结果

## 数据结构说明

### UserSubdomain实体

| 字段名 | 类型 | 说明 |
|:----:|:----:|:----:|
| id | Long | 记录ID |
| userId | Long | 用户ID |
| subdomain | String | 子域名前缀 |
| domain | String | 主域名 |
| recordId | Long | DNSPod记录ID |
| ipAddress | String | IP地址 |
| ttl | Integer | TTL值 |
| status | String | 状态：ACTIVE-活跃，INACTIVE-不活跃，DELETED-已删除 |
| remark | String | 备注信息，格式为"subdomain.email" |
| createTime | LocalDateTime | 创建时间 |
| updateTime | LocalDateTime | 更新时间 |

## 性能指标

- 平均响应时间：约226.52毫秒
- 最大并发请求数：100/秒
- 建议客户端实现请求重试机制，重试间隔建议为1秒

## 安全注意事项

- 该接口需要用户登录后获取的JWT令牌才能访问
- 令牌过期时间为24小时，过期后需要重新登录获取新令牌
- 请勿在URL中传递敏感信息，应使用POST请求体传递参数
- 接口有访问频率限制，请勿频繁调用

## 测试结果

接口测试已完成，主要测试结果如下：

1. **基本功能测试**：成功。接口能够正确返回匹配的域名记录列表。
2. **缺少子域名参数测试**：成功。接口正确返回400状态码。
3. **空子域名参数测试**：成功。接口正确返回400状态码。
4. **无效令牌测试**：部分成功。接口返回500状态码而不是预期的401状态码。
5. **缺少令牌测试**：成功。接口正确返回401状态码。

## 已知问题

- 当提供格式错误的JWT令牌时，接口返回500错误而不是401错误。这个问题将在下一版本修复。

## 备注

- 系统会根据子域名前缀和用户邮箱构造remark格式(subdomain.email)进行查询
- 如果没有找到匹配的记录，将返回空数组
- 该接口仅返回状态为非"DELETED"的记录
- 返回结果按创建时间降序排序
